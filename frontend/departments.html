<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Телефонный справочник</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Istok+Web:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header class="header">
        <div class="header-left">
            <img src="logo.jpg" alt="Росатом" class="logo">
            <span class="company-name">РОСАТОМ</span>
        </div>
        <div class="header-center">
            <h1 class="gradient-text" onclick="location.href='index.html'">Телефонный справочник</h1>
        </div>
        <div class="header-right">
            <button class="btn-primary" onclick="location.href='login.html'">Войти</button>
        </div>
    </header>

    <main class="main-content">
        <aside class="sidebar">
            <div class="division-links">
                <a href="#" id="link-giredmet" onclick="switchDivision('giredmet')">Гиредмет</a> /
                <a href="#" id="link-graphite" onclick="switchDivision('graphite')">Графит</a>
            </div>

            <ul class="department-list" id="department-list">
            </ul>
            <button class="add-btn" onclick="openAddDepartmentModal()">Добавить отдел</button>
        </aside>
        <section class="center-panel">
            <nav class="breadcrumbs" id="breadcrumbs">
            </nav>
            <input type="text" class="search-bar" placeholder="Например: Иванов, Дарья, marina@gmail.com">
            <button class="add-btn" onclick="openAddContactModal()">Добавить контакт</button>
            <button class="add-btn" onclick="openImportModal()">Импортировать</button>
            <div class="employee-table-wrapper">
                <table class="employee-table">
                    <thead>
                        <tr>
                            <th>ФИО</th>
                            <th>Телефон</th>
                            <th>Кабинет</th>
                            <th>Email</th>
                            <th>Должность</th>
                            <th>Отдел</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="contact.html" class="fio-link">Смирнов<br>А. И.</a></td>
                            <td>+7 (495) 123-45-67</td>
                            <td>105</td>
                            <td>alex.smirnov@techcorp.com</td>
                            <td>Ведущий разработчик</td>
                            <td>Инженерный</td>
                        </tr>


                        <tr>
                            <td><a href="contact.html" class="fio-link">Карцев<br>А. И.</a></td>
                            <td>+7 (999) 987-65-43</td>
                            <td>202</td>
                            <td>kraken@techcorp.com</td>
                            <td>Дедушка</td>
                            <td>Коммуникации</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>


        <aside class="birthday-panel">
            <h3>Поздравляем<br>с Днём рождения!</h3>
            <img src="person.jpg" alt="Фото сотрудника" class="birthday-photo">
            <p class="birthday-name">Иванов Иван Иванович</p>

            <div class="upcoming-birthdays">
                <h4>Дни рождения завтра:</h4>
                <ul class="birthday-list">
                    <li>Петров Пётр Петрович</li>
                    <li>Сидорова Марина Александровна</li>
                    <li>Кузнецов Иван Сергеевич</li>
                </ul>
            </div>
        </aside>


    </main>

    <footer class="footer">
        Если обнаружили неточности, напишите на почту it_rosatom@mail.ru
    </footer>
    <script>
        const departments = {
            giredmet: ["Инженерный", "Коммуникации", "Коммерческий", "Бухгалтерия"],
            graphite: ["Проектный", "Логистика", "Финансовый контроль", "Отдел кадров"]
        };

        function switchDivision(name) {
            const list = document.getElementById('department-list');
            list.innerHTML = '';

            departments[name].forEach(dept => {
                const li = document.createElement('li');
                li.textContent = dept;
                li.style.cursor = "pointer";
                li.onclick = () => {
                    window.location.href = `departments.html?division=${encodeURIComponent(name)}&department=${encodeURIComponent(dept)}`;
                };
                list.appendChild(li);
            });

            document.getElementById('link-giredmet').classList.remove('active-division');
            document.getElementById('link-graphite').classList.remove('active-division');
            document.getElementById(`link-${name}`).classList.add('active-division');
        }

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const division = params.get('division');
            const department = params.get('department');
            switchDivision('giredmet');
            const breadcrumbs = document.getElementById('breadcrumbs');
            if (!breadcrumbs) return;

            let html = `<a href="index.html">Главная</a>`;

            if (division) {
                html += ` / ${capitalize(division)}`;
            }
            if (department) {
                html += ` / ${department}`;
            }

            breadcrumbs.innerHTML = html;
        };

        function capitalize(str) {
            if (!str) return '';
            const map = {
                giredmet: "Гиредмет",
                graphite: "Графит"
            };
            return map[str.toLowerCase()] || str.charAt(0).toUpperCase() + str.slice(1);
        }

        function openAddContactModal() {
            document.getElementById("addContactModal").style.display = "flex";
        }

        function closeAddContactModal() {
            document.getElementById("addContactModal").style.display = "none";
        }

        function openAddDepartmentModal() {
            document.getElementById("addDepartmentModal").style.display = "flex";
        }

        function closeAddDepartmentModal() {
            document.getElementById("addDepartmentModal").style.display = "none";
        }

        function openImportModal() {
            document.getElementById("importModal").style.display = "flex";
        }

        function closeImportModal() {
            document.getElementById("importModal").style.display = "none";
        }

        // Импорт контактов
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                const response = await fetch('/api/import-users', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                alert(result.status || 'Импорт завершён');
            } catch (err) {
                alert('Ошибка при импорте файла');
                console.error(err);
            }
        });

        document.getElementById('fileInput').addEventListener('change', function () {
            const fileNameSpan = document.getElementById('fileName');
            fileNameSpan.textContent = this.files.length > 0 ? this.files[0].name : 'Файл не выбран';
        });

        window.onclick = function (event) {
            if (event.target === document.getElementById("addContactModal")) {
                closeAddContactModal();
            }

            if (event.target === document.getElementById("addDepartmentModal")) {
                closeAddDepartmentModal();
            }

            if (event.target === document.getElementById("importModal")) {
                closeImportModal();
            }
        };
    </script>


    <div id="addContactModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddContactModal()">&times;</span>
            <h2>Добавление контакта</h2>
            <p class="modal-subtitle">Заполните поля</p>
            <form id="contactForm">
                <input type="text" placeholder="ФИО контакта" required>
                <input type="text" placeholder="Отдел" required>
                <input type="email" placeholder="Почта" required>
                <input type="tel" placeholder="Рабочий телефон" required>
                <input type="text" placeholder="Описание (опционально)">
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" onclick="closeAddContactModal()">Отмена</button>
                    <button type="submit" class="submit-btn">Добавить</button>
                </div>
            </form>
        </div>
    </div>
    <div id="addDepartmentModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddDepartmentModal()">&times;</span>
            <h2>Добавление отдела</h2>
            <p class="modal-subtitle">Укажите название отдела<br>Отдел будет добавлен в выбранный институт</p>
            <form id="departmentForm">
                <input type="text" placeholder="Название отдела" required>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" onclick="closeAddDepartmentModal()">Отмена</button>
                    <button type="submit" class="submit-btn">Добавить</button>
                </div>
            </form>
        </div>
    </div>
    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeImportModal()">&times;</span>
            <h2>Импорт контактов</h2>
            <p class="modal-subtitle">Загрузите файл с контактами</p>
            <form id="uploadForm" enctype="multipart/form-data" method="post">
                <div class="file-upload-wrapper">
                    <label for="fileInput" class="file-upload-label">Выбрать файл</label>
                    <span id="fileName" class="file-name">Файл не выбран</span>
                    <input type="file" name="file" id="fileInput" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" onclick="closeImportModal()">Отмена</button>
                    <button type="submit" class="submit-btn">Импортировать</button>
                </div>
            </form>
        </div>
    </div>


</body>

</html>
